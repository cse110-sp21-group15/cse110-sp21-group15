<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>app/components/entry-list.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dailyLog">dailyLog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#downloadPage">downloadPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#featuresPage">featuresPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#homePage">homePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#pushToHistory">pushToHistory</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">app/components/entry-list.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class EntryList extends HTMLElement {
  constructor() {
    super();

    const template = document.createElement('template');

    template.innerHTML = `
        &lt;style>

            @font-face {
                font-family: "Amaranth";
                src: url(./Amaranth/Amaranth-Regular.ttf) format("truetype")
            }
            @font-face {
                font-family: "Mulish";
                src: url(./Mulish/static/Mulish-Regular.ttf) format("truetype")
            }

            svg, image {
                pointer-events: none;
            }

            .entry-handler {
                padding: 1rem 1.5rem;
                min-width: 650px;
            }
            
            .single-entry {
                width: 75%;
                height: 100%;
                margin-top: 0.5rem;
                display: flex;
                flex-direction: row;
                flex-align: center;
            }

            .bullet {
                /* Remove default styling */
                background: none;
                cursor: pointer;
                border: none;
                padding: 0;
                outline: inherit;

                width: 35px;
                height: 35px;
                margin-right: 0.5rem;
                transition: width 0.25s;
            }
            .bullet:hover {
                width: 42px;
            }
            
            .single-entry input[type=date] {
                background-color: transparent;
                display: block;
                font-family: "Mulish";
                font-weight: bold;
                font-size: 24px;
                color: #000000;
                width: 200px;
                min-width: 200px;
                border: none;
                border-bottom: 2px solid #00000000;
                margin-right: 1rem;
                transition: border-bottom 0.25s, color 0.25s;
            }
            input[type=date]:hover {
                border-bottom: 2px solid #000000FF;
            }
            input[type=date]:focus {
                outline: none;
                border-bottom: 2px solid #3d84b8FF;
                color: #3d84b8;
            }

            .single-entry span {
                width: 80%;
            }
            input[type=text] {
                background: transparent;
                font-family: "Mulish";
                font-weight: bold;
                font-size: 24px;
                width: 100%;
                color: #000000;
                border: none;
                border-bottom: 2px solid #00000000;
                transition: border-bottom 0.25s, color 0.25s;
            }
            input[type=text]:hover {
                border-bottom: 2px solid #000000FF;
            }
            input[type=text]:focus {
                outline: none;
                border-bottom: 2px solid #3d84b8FF;
                color: #3d84b8;
            }
            .crossout {
                pointer-events: none;
                text-decoration: line-through;
            }
            .complete {
                pointer-events: none;
                font-style: italic;
            }

            .bullet:hover:after {
                width: 100%;
                z-index: 98;
                position: fixed;
                bottom: 0;
                left:0;
                background-color: #FFFFFF;
                font-family: "Mulish";
                font-size: 18px;
                color: #000000;
                padding: 1em;
                content: "Left Click: Toggle bullet type | Right Click: Cross/uncross out entry";
                text-align: center;
            }
            .single-entry span:hover:after {
                width: 100%;
                z-index: 98;
                position: fixed;
                bottom: 0;
                left:0;
                background-color: #FFFFFF;
                font-family: "Mulish";
                font-size: 18px;
                color: #000000;
                padding: 1em;
                content: "Left Click: Edit entry text | Right Click: Migrate entry";
                text-align: center;
            }

            .new-entry {
                font-family: "Mulish";
                font-weight: bold;
                font-size: 18px;
                text-align: center;
                letter-spacing: -0.015em;
                color: #F0EBCC;
                background-color: #344FA1;
                border-radius: 5px;
                padding: 10px 36px;
                margin-top: 0.5rem;
                width: 100%
                cursor: pointer;
                border: none;
                outline: inherit;
                cursor: pointer;
                transition: background-color 0.5s;
            }
            .new-entry:hover {
                color: #fffbe3;
                background-color: #5f52d8;
            }

        &lt;/style>
        &lt;section class="entry-handler">
            &lt;section class="entries">
            &lt;/section>
            &lt;button class="new-entry" type="button">+ Add&lt;/button>
        &lt;/section>
        `;
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.appendChild(template.content.cloneNode(true));

    const entriesSection = this.shadowRoot.querySelector('.entries');

    const attribMonth = this.getAttribute('month');
    const attribDay = this.getAttribute('day');
    const attribYear = this.getAttribute('year');
    const attribShowDate = this.getAttribute('showDate');

    const dateObj = new Date();
    this.month = (attribMonth) || dateObj.getMonth(); // january = 0, ..., december = 11
    this.day = (attribDay) || dateObj.getDate();
    this.year = (attribYear) || dateObj.getFullYear();
    this.showDate = (attribShowDate) || true;

    this.shadowRoot.addEventListener('click', (event) => {
      const clicked = event.target;
      if (clicked.closest('.new-entry')) { // new entry when add button is clicked
        this.newEntry('', this.showDate, this.month, this.day, this.year);
      } else if (clicked.closest('.bullet')) { // toggles bullet type when clicked
        const img = clicked.querySelector('image');
        const text = clicked.parentElement.querySelector('.entry-text');
        if (img.classList.contains('task')) {
          clicked.innerHTML = "&lt;svg width='100%' height='100%' viewBox='0 0 157 84' xmlns='http://www.w3.org/2000/svg'>"
                                        + "&lt;image class='x' href='./media/x-bullet.svg' width='100%' height='100%'/>&lt;/svg>";
          text.classList.add('complete');
        }
        if (img.classList.contains('x')) {
          clicked.innerHTML = "&lt;svg width='100%' height='100%' viewBox='0 0 157 84' xmlns='http://www.w3.org/2000/svg'>"
                                        + "&lt;image class='event' href='./media/event-bullet.svg' width='100%' height='100%'/>&lt;/svg>";
          text.classList.remove('complete');
        }
        if (img.classList.contains('event')) {
          clicked.innerHTML = "&lt;svg width='100%' height='100%' viewBox='0 0 157 84' xmlns='http://www.w3.org/2000/svg'>"
                                        + "&lt;image class='note' href='./media/note-bullet.svg' width='100%' height='100%'/>&lt;/svg>";
        }
        if (img.classList.contains('note')) {
          clicked.innerHTML = "&lt;svg width='100%' height='100%' viewBox='0 0 157 84' xmlns='http://www.w3.org/2000/svg'>"
                                        + "&lt;image class='task' href='./media/task-bullet.svg' width='100%' height='100%'/>&lt;/svg>";
        }
      }
    });

    this.shadowRoot.addEventListener('contextmenu', (event) => { // right clicking the bullet toggles cross out
      const clicked = event.target;
      if (clicked.closest('.bullet')) {
        event.preventDefault();
        const text = clicked.parentElement.querySelector('.entry-text');
        if (text.classList.contains('crossout')) {
          text.classList.remove('crossout');
        } else {
          text.classList.add('crossout');
        }
      } else if (clicked.closest('.entry-text')) { // right clicking entry text will trigger migration menu
        event.preventDefault();
        // TODO: finish migration stuff
      }
    }, false);
  }

  // managing/populating entries
  get entries() { // get all the entries and format in an object
    const allEntries = this.shadowRoot.querySelectorAll('.single-entry');
    const entriesObj = {};
    let entryNum = 0;

    allEntries.forEach((entry) => {
      const datePicker = entry.querySelector('.date-picker');
      const entryObj = {
        text: entry.querySelector('.entry-text').value, // entry contents
        showDate: (datePicker !== null), // if entry contains a date or not
        type: entry.querySelector('image').getAttribute('class'), // bullet type
      };
      if (datePicker !== null) {
        const d = new Date(datePicker.value);
        entryObj.month = d.getMonth();
        entryObj.day = d.getDate();
        entryObj.year = d.getFullYear();
      } else {
        entryObj.month = this.month;
        entryObj.day = this.day;
        entryObj.year = this.year;
      }
      entriesObj[`entry${entryNum}`] = entryObj;
      entryNum++;
    });

    return entriesObj;
  }

  set entries(entriesObj) { // create a list of all entries based on the given object
    const allEntries = this.shadowRoot.querySelectorAll('.single-entry');
    allEntries.forEach((entry) => { // clear existing entries (to be replaced)
      entry.remove();
    });

    for (const key in entriesObj) {
      if (entriesObj.hasOwnProperty(key) &amp;&amp; entriesObj[key].hasOwnProperty('text') &amp;&amp; entriesObj[key].hasOwnProperty('showDate')) { // checks for valid entry objects
        // add entries
        const entry = entriesObj[key];
        this.newEntry(entry.text, entry.showDate, entry.month, entry.day, entry.year, entry.type);
      }
    }
  }

  /**
     * Creates a new entry in the entries section and focuses the text field of the new entry
     * @param {string} txt text to be displayed in the entry, use "" if empty
     * @param {boolean} showDate true if the entry displays a date (monthly log), false otherwise (daily log)
     * @param {number} month month of the entry, January = 0, ... , December = 11
     * @param {number} day day of the entry
     * @param {number} year year of the entry
     * @param {string} type the type of bullet of the entry, defaults to task
     * @returns {number}
     */
  newEntry(txt, showDate, month, day, year, type) {
    const entriesSection = this.shadowRoot.querySelector('.entries');

    if (type === undefined) { // default type
      type = 'task';
    }
    console.log(`${txt} ${type}`);

    const entry = document.createElement('section');
    entry.classList.add('single-entry');

    if (showDate) {
      const dateElement = document.createElement('input');
      entry.appendChild(dateElement);
      const formattedDay = (day &lt; 10) ? `0${day}` : day.toString();
      const formattedMonth = (month + 1 &lt; 10) ? `0${month + 1}` : (month + 1).toString();
      const minDate = `${year.toString()}-${formattedMonth}-01`;
      const maxDate = `${year.toString()}-${formattedMonth}-${new Date(year, month + 1, 0).getDate()}`;
      const today = `${year.toString()}-${formattedMonth}-${formattedDay}`;
      dateElement.outerHTML = `&lt;input type='date' class='date-picker' min='${minDate}' max='${maxDate}' value='${today}'>`;
    }

    const bulletElement = document.createElement('button');
    entry.appendChild(bulletElement);
    bulletElement.outerHTML = `${"&lt;button class='bullet' type='button'>&lt;svg width='100%' height='100%' viewBox='0 0 157 84' xmlns='http://www.w3.org/2000/svg'>"
                        + "&lt;image class='"}${type}' href='./media/${type}-bullet.svg' width='100%' height='100%'/>&lt;/svg>&lt;/button>`;

    const textSpan = document.createElement('span');
    entry.appendChild(textSpan);

    const textElement = document.createElement('input');
    textElement.type = 'text';
    textElement.classList.add('entry-text');
    if (type == 'x') { textElement.classList.add('complete'); }
    textElement.value = txt;
    textElement.setAttribute('maxlength', 32);
    textSpan.appendChild(textElement);

    textElement.addEventListener('keypress', (event) => { // after pressing enter while editing the entry text, add a new entry
      if (event.key == 'Enter') {
        this.newEntry('', this.showDate, this.month, this.day, this.year);
      }
    });

    textElement.addEventListener('blur', (event) => { // if an entry is deselected and has no text in its entry, delete it
      if (event.target.value == '') {
        event.target.parentElement.parentElement.remove();
      }
    });

    entriesSection.appendChild(entry);
    document.activeElement.blur();
    textElement.focus();
  }

  /**
     * JSON Format for entry lists:
     *
     * {
     *      'entry0': {
     *          text: 'New Years!',
     *          showDate: true,
     *          type: 'note',
     *          month: 0,
     *          day: 1,
     *          year: 2021
     *      },
     *      'entry1': {
     *          text: 'Laundry',
     *          showDate: true,
     *          type: 'task',
     *          month: 0,
     *          day: 5,
     *          year: 2021
     *      },
     *      ...
     * }
     */

  /*
    Setting up the component on a page:

        let entryList = document.createElement('entry-list');
        entryList.showDate = true;  // false for daily logs, true for monthly logs
        // should still set month, day, and year attributes for daily logs because it'll be useful for migration
        entryList.month = 0;        // January
        entryList.day = 15;         // Jan 15
        entryList.year = 2021;      // Jan 15 2021
        document.querySelector('main').prepend(entryList);

    Importing/modifying entry lists in a page:

        let entryList = document.querySelector('entry-list');
        entryList.entries = { 'entry0': { text: 'New Years!', showDate: true, type: 'note', month: 0, day: 1, year: 2021} };  // set initial entry
        let tempList = entryList.entries;
        delete tempList['entry0'];
        entryList.entries = tempList;   // deletes the New Years note from the menu
        entryList.entries = { 'entry3': { text: 'New Years!', showDate: true, type: 'note', month: 0, day: 1, year: 2021} };
        tempList = entryList.entries;   // reformats and reorders the collection keys in the object
        tempList['entry1'] = { text: 'Laundry', showDate: true, type: 'task', month: 0, day: 5, year: 2021};
        entryList.entries = tempList;    // adds the new laundry task to the menu
     */
}

customElements.define('entry-list', EntryList);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Jun 12 2021 16:54:39 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
